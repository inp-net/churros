.test:app:
  extends: .test
  variables:
    PACKAGE: app

test:app:no-undeclared-native-changes:
  stage: test
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes: [packages/app/android, packages/app/ios]
  script:
    - |
      if grep -q "^'@churros/app': major$" .changeset/*.md; then
        echo All good!
      else
        echo You changed native code for the app. Include a changeset with a major bump. This is required to not break update bundles that will be sent to users for over-the-air updates.
        exit 1
      fi

test:app:lint:
  extends: .test:app
  allow_failure: true # cuz eslint gives "Something went wrong" error in CI...
  script:
    - yarn @app generate
    - yarn eslint --cache=true $(cat changes.txt)

test:app:format:
  extends: .test:app
  script:
    - yarn prettier --check --ignore-unknown --no-error-on-unmatched-pattern $(cat changes.txt)

test:app:svelte-check:
  extends: .test:app
  script:
    - yarn @app generate
    - yarn @app verify
