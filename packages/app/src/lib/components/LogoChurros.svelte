<script lang="ts">
  export let textColor = 'var(--header-text, var(--text))';
  export let wordmark = false;

  export let drawing = false;
  export let loopDrawingAnimation = false;

  let faceElement: SVGPathElement;
  $: facePathLength = faceElement?.getTotalLength();

  const dashRatio = loopDrawingAnimation ? 1 / 6 : 1;

  function dashArray(ratio: number, totalLength: number) {
    if (ratio === 1) return totalLength;
    return `${ratio * totalLength},${(1 - ratio) * totalLength}`;
  }
</script>

<div class="logo" class:has-wordmark={wordmark}>
  <svg
    width={wordmark ? undefined : '100%'}
    viewBox="0 0 2345 2345"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class:loop={loopDrawingAnimation}
  >
    <path
      class="main"
      d="M1545.72 1550.32C1545.77 1553.4 1545.8 1556.47 1545.81 1559.52M1545.72 1550.32C1545.22 1520.34 1542.95 1490.15 1539 1459.9M1545.72 1550.32L1545.81 1559.52M883.105 616.205C846.647 602.755 810.941 592.757 776.218 586.048M883.105 616.205C912.712 627.128 941.893 639.987 970.521 654.602M883.105 616.205L776.218 586.048M883.105 616.205L970.521 654.602M1316.86 1475.06C1316.74 1527.76 1307.96 1575.02 1291.93 1615.85M1316.86 1475.06L1441.9 1521.19M1316.86 1475.06L1291.93 1615.85M1235.49 1178.32C1183.68 1083.33 1110.42 997.842 1025.48 935.613M1235.49 1178.32L1417.3 1101.35M1235.49 1178.32L1752.49 852.318M1025.48 935.613L1091.6 729.025M1025.48 935.613L1542.48 609.613M1236.5 1705.08C1259.6 1680.34 1278.36 1650.4 1291.93 1615.85M1236.5 1705.08L1379.61 1865.73L1424.63 1916.27M1236.5 1705.08L1291.93 1615.85M677.157 575.648C709.091 576.056 742.183 579.472 776.218 586.048M677.157 575.648L731.403 751.734L745.242 796.654M677.157 575.648C677.157 575.648 756.048 525.902 806.598 494.028M677.157 575.648L776.218 586.048M677.157 575.648L806.598 494.028M1091.6 729.025C1066.43 710.816 1040.61 693.932 1014.23 678.523C1012.32 677.402 1010.4 676.29 1008.47 675.185C995.94 667.985 983.285 661.119 970.521 654.602M1091.6 729.025L1608.6 403.025M1545.81 1559.52L1564.67 1547.63L1781.73 1410.76M1545.81 1559.52L1441.9 1521.19M1417.3 1101.35L1767.2 880.718L1934.3 775.352M1417.3 1101.35C1461.07 1180.56 1495.17 1264.14 1517.21 1348.73C1526.85 1385.69 1534.18 1422.84 1539 1459.9M1424.63 1916.27C1344.73 2003.6 1230.32 2049.83 1096.65 2044.14L1022.48 1785.92C984.65 1783.96 944.484 1775.62 902.793 1760.31M1424.63 1916.27L1941.63 1590.27L1781.73 1410.76M367.214 1510.27C447.972 1659.39 563.009 1793.52 696.51 1890.39M367.214 1510.27L550.859 1436.59C545.217 1426.04 539.839 1415.39 534.738 1404.63M367.214 1510.27L534.738 1404.63M696.51 1890.39L763.02 1684.08C806.712 1716.18 853.507 1742.13 902.072 1760.05C902.312 1760.14 902.553 1760.23 902.793 1760.31M696.51 1890.39L902.793 1760.31M355.099 714.713L546.645 921.882C579.069 884.607 620.815 858.215 669.27 844.559M355.099 714.713C284.206 798.05 243.018 915.767 243.405 1059.45L472.362 1144.35C472.348 1147.66 472.369 1151 472.425 1154.36C473.81 1237.85 496.445 1323.9 534.738 1404.63M355.099 714.713L872.099 388.713L909.486 429.15M1752.49 852.318C1700.68 757.332 1627.42 671.842 1542.48 609.613M1752.49 852.318L1934.3 775.352M1542.48 609.613L1608.6 403.025M1539.48 1459.92C1539.32 1459.91 1539.16 1459.9 1539 1459.9M1608.6 403.025C1542.92 355.514 1472.8 317.024 1400.1 290.205C1327.91 263.572 1258.67 250.473 1194.16 249.648L909.486 429.15M1934.3 775.352C2012.8 917.414 2060.22 1073.57 2062.72 1224.32C2062.77 1227.4 2062.8 1230.47 2062.81 1233.52L1781.73 1410.76M1291.93 1615.85L1441.9 1521.19M909.486 429.15C909.486 429.15 846.778 468.691 806.598 494.028M745.242 796.654L756.724 833.928C725.768 833.243 696.462 836.895 669.27 844.559M745.242 796.654L669.27 844.559"
      stroke="var(--fg)"
      stroke-width="var(--logo-stroke-width)"
    />
    <path
      class="face-masker"
      class:drawing
      d="M902.072 1760.05C853.507 1742.13 806.712 1716.18 763.02 1684.08L696.51 1890.39C563.009 1793.52 447.972 1659.39 367.214 1510.27L550.859 1436.59C545.217 1426.04 539.839 1415.39 534.738 1404.63C496.445 1323.9 473.81 1237.85 472.425 1154.36C472.369 1151 472.348 1147.66 472.362 1144.35L243.405 1059.45C243.018 915.767 284.206 798.05 355.099 714.713L546.645 921.882C579.069 884.607 620.815 858.215 669.27 844.559C696.462 836.895 725.768 833.243 756.724 833.928L677.157 575.648C709.091 576.056 742.183 579.472 776.218 586.048L883.105 616.205C912.712 627.128 941.893 639.987 970.521 654.602C983.285 661.119 995.94 667.985 1008.47 675.185C1010.4 676.29 1012.32 677.402 1014.23 678.523C1040.61 693.932 1066.43 710.816 1091.6 729.025L1025.48 935.613C1110.42 997.842 1183.68 1083.33 1235.49 1178.32L1417.3 1101.35C1461.07 1180.56 1495.17 1264.14 1517.21 1348.73C1526.85 1385.69 1534.18 1422.84 1539 1459.9C1542.95 1490.15 1545.22 1520.34 1545.72 1550.32L1545.81 1559.52L1316.86 1475.06C1316.74 1527.76 1307.96 1575.02 1291.93 1615.85C1278.36 1650.4 1259.6 1680.34 1236.5 1705.08L1424.63 1916.27C1344.73 2003.6 1230.32 2049.83 1096.65 2044.14L1022.48 1785.92C984.65 1783.96 944.484 1775.62 902.793 1760.31"
      stroke="var(--bg3)"
      stroke-width="calc( 2* var(--logo-stroke-width))"
    />
    <path
      bind:this={faceElement}
      class="face"
      class:drawing
      d="M902.072 1760.05C853.507 1742.13 806.712 1716.18 763.02 1684.08L696.51 1890.39C563.009 1793.52 447.972 1659.39 367.214 1510.27L550.859 1436.59C545.217 1426.04 539.839 1415.39 534.738 1404.63C496.445 1323.9 473.81 1237.85 472.425 1154.36C472.369 1151 472.348 1147.66 472.362 1144.35L243.405 1059.45C243.018 915.767 284.206 798.05 355.099 714.713L546.645 921.882C579.069 884.607 620.815 858.215 669.27 844.559C696.462 836.895 725.768 833.243 756.724 833.928L677.157 575.648C709.091 576.056 742.183 579.472 776.218 586.048L883.105 616.205C912.712 627.128 941.893 639.987 970.521 654.602C983.285 661.119 995.94 667.985 1008.47 675.185C1010.4 676.29 1012.32 677.402 1014.23 678.523C1040.61 693.932 1066.43 710.816 1091.6 729.025L1025.48 935.613C1110.42 997.842 1183.68 1083.33 1235.49 1178.32L1417.3 1101.35C1461.07 1180.56 1495.17 1264.14 1517.21 1348.73C1526.85 1385.69 1534.18 1422.84 1539 1459.9C1542.95 1490.15 1545.22 1520.34 1545.72 1550.32L1545.81 1559.52L1316.86 1475.06C1316.74 1527.76 1307.96 1575.02 1291.93 1615.85C1278.36 1650.4 1259.6 1680.34 1236.5 1705.08L1424.63 1916.27C1344.73 2003.6 1230.32 2049.83 1096.65 2044.14L1022.48 1785.92C984.65 1783.96 944.484 1775.62 902.793 1760.31"
      stroke="var(--primary)"
      stroke-width="calc( 2* var(--logo-stroke-width))"
      stroke-dasharray={dashArray(dashRatio, facePathLength)}
      stroke-dashoffset={facePathLength}
    />
    <path
      class="hole"
      d="M712 1242.19L879.177 1125.67L1046.35 1365.54L879.177 1482.06L712 1242.19Z"
      stroke="var(--fg)"
      stroke-width="var(--logo-stroke-width)"
    />
  </svg>
  {#if wordmark}
    <svg
      class="wordmark"
      height="100%"
      viewBox="1000 0 2300 900"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M1462.53 231.898C1417.82 190.688 1358.11 165.518 1292.51 165.518C1153.92 165.518 1041.58 277.863 1041.58 416.449C1041.58 555.034 1153.92 667.379 1292.51 667.379C1360.79 667.379 1422.71 640.104 1467.95 595.852"
        stroke={textColor}
        stroke-width="72"
      />
      <path
        d="M1551.16 162V694.349V532.533C1551.16 458.06 1610.87 397.687 1684.51 397.687C1758.16 397.687 1817.86 458.06 1817.86 532.533V694.349"
        stroke={textColor}
        stroke-width="72"
      />
      <path
        d="M2181.27 370L2181.27 531.815C2181.27 606.289 2120.9 666.661 2046.42 666.661C1971.95 666.661 1911.58 606.288 1911.58 531.815L1911.58 370"
        stroke={textColor}
        stroke-width="72"
      />
      <circle cx="2828.08" cy="544.5" r="142.5" stroke={textColor} stroke-width="72" />
      <path d="M2282.58 701V408H2435.58" stroke={textColor} stroke-width="72" />
      <path d="M2498.58 701V408H2655.58" stroke={textColor} stroke-width="72" />
      <path
        d="M3242.58 479.5C3230.08 448 3190.98 414.5 3146.58 414.5C3113.58 414.5 3058.88 433.9 3066.08 489.5C3067.37 499.5 3073.58 539.861 3146.58 550C3154.08 551.042 3248.08 566.5 3237.08 635C3237.08 635 3226.08 695.5 3146.58 693.5C3122.91 694 3069.68 680.5 3046.08 622.5"
        stroke={textColor}
        stroke-width="72"
      />
    </svg>
  {/if}
</div>

<style>
  .logo.has-wordmark {
    display: grid;
    grid-template-columns: 1.5fr 3fr;
    min-width: 130px;
    min-height: 50px;
  }

  path.face-masker {
    stroke: var(--fg);
    stroke-width: var(--logo-stroke-width);
    transition: all 500ms ease;
  }

  @media (prefers-reduced-motion: no-preference) {
    path.face.drawing {
      animation: draw 700ms ease forwards;
    }

    .loop path.face.drawing {
      animation: draw 1s infinite linear;
    }

    path.face-masker.drawing {
      stroke: var(--bg3);
      stroke-width: calc(var(--logo-stroke-width) * 2);
    }

    @keyframes draw {
      to {
        stroke-dashoffset: 0;
      }
    }
  }

  @media (prefers-reduced-motion: reduce) {
    path.face-masker {
      animation: pulse 350ms infinite alternate ease;
    }

    @keyframes pulse {
      to {
        stroke: var(--primary);
      }
    }
  }
</style>
